<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hash Rythm | Research Collective</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        /* Smooth scrolling */
        html { scroll-behavior: smooth; }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #060608; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #f59e0b; }
    </style>
</head>
<body class="bg-[#060608] text-slate-400 selection:bg-amber-500/30 antialiased overflow-x-hidden">

    <div class="fixed inset-0 overflow-hidden pointer-events-none z-0">
        <div class="absolute top-0 left-1/4 w-[600px] h-[600px] bg-amber-500/[0.03] blur-[120px] rounded-full"></div>
        <div class="absolute bottom-0 right-1/4 w-[600px] h-[600px] bg-indigo-500/[0.03] blur-[120px] rounded-full"></div>
    </div>

    <nav id="navbar" class="fixed top-0 left-0 right-0 z-[100] transition-all duration-500 py-6 md:py-8">
        <div class="max-w-7xl mx-auto px-4 md:px-6">
            <div id="nav-container" class="flex items-center justify-between px-4 md:px-6 py-3 rounded-2xl border border-transparent transition-all">
                <div class="flex items-center gap-3 group cursor-pointer">
                    <div class="w-8 h-8 md:w-9 md:h-9 bg-amber-500 rounded-xl flex items-center justify-center shadow-lg shadow-amber-500/20">
                        <i data-lucide="zap" class="text-black w-4 h-4 md:w-5 md:h-5 fill-current"></i>
                    </div>
                    <div class="flex flex-col">
                        <span class="font-bold text-base md:text-lg text-white tracking-tight uppercase italic leading-none">Hash Rythm</span>
                        <span class="text-[8px] md:text-[9px] font-bold text-amber-500 uppercase tracking-widest mt-1">Research Collective</span>
                    </div>
                </div>

                <div class="hidden lg:flex gap-10 items-center">
                    <a href="#architecture" class="text-[10px] font-bold text-slate-500 hover:text-white uppercase tracking-widest transition-all">Architecture</a>
                    <a href="#analytics" class="text-[10px] font-bold text-slate-500 hover:text-white uppercase tracking-widest transition-all">Analytics</a>
                    <a href="#simulator" class="text-[10px] font-bold text-slate-500 hover:text-white uppercase tracking-widest transition-all">Simulator</a>
                    <a href="#community" class="text-[10px] font-bold text-slate-500 hover:text-white uppercase tracking-widest transition-all">Community</a>
                </div>

                <button id="auth-btn" class="bg-white text-black px-4 md:px-6 py-2 rounded-xl text-[10px] md:text-xs font-bold hover:bg-amber-500 hover:text-white transition-all transform active:scale-95">
                    Initiate Sync
                </button>
            </div>
        </div>
    </nav>

    <section class="relative pt-32 md:pt-48 pb-20 md:pb-32 px-6 max-w-7xl mx-auto z-10 text-center">
        <div class="opacity-0 translate-y-5 animate-fade-in-up" style="animation: fadeInUp 0.8s forwards;">
            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-amber-500/5 border border-amber-500/10 text-amber-500 text-[9px] md:text-[10px] font-bold tracking-widest uppercase mb-8">
                <i data-lucide="history" class="w-3 h-3"></i> Technical Evolution of Bitcoin L2
            </div>
            <h1 class="text-4xl md:text-7xl font-black text-white mb-8 tracking-tighter leading-[1.1]">
                Unlocking <br />
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-amber-200 via-amber-400 to-amber-600">Off-Chain Velocity</span>
            </h1>
            <p class="max-w-2xl mx-auto text-slate-400 text-sm md:text-lg leading-relaxed mb-12">
                Scaling Bitcoin without compromising decentralization. Hash Rythm provides an 
                institutional knowledge base for high-frequency settlement infrastructure.
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href="#analytics" class="px-8 py-4 bg-amber-500 text-black font-bold rounded-xl hover:bg-amber-400 transition-all shadow-lg flex items-center justify-center gap-2 group text-sm">
                    Explore Network <i data-lucide="arrow-right" class="w-4 h-4 group-hover:translate-x-1 transition-transform"></i>
                </a>
                <a href="#architecture" class="px-8 py-4 bg-white/5 border border-white/10 text-white font-bold rounded-xl hover:bg-white/10 transition-all text-sm flex items-center justify-center">
                    Documentation
                </a>
            </div>
        </div>
    </section>

    <section id="analytics" class="py-12 md:py-24 px-6 max-w-7xl mx-auto z-10 relative">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <div class="lg:col-span-3 bg-[#0d0d10] border border-white/5 rounded-[32px] p-6 md:p-10 shadow-2xl relative overflow-hidden group">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-10 gap-6">
                    <div>
                        <h3 class="text-white text-xl font-bold mb-1 italic uppercase tracking-tight">Network Momentum</h3>
                        <p class="text-slate-500 text-xs md:text-sm">Aggregate liquidity across public Bitcoin L2 channels</p>
                    </div>
                    <div class="flex gap-8">
                        <div class="text-right">
                            <div class="text-[9px] md:text-[10px] font-bold text-slate-600 uppercase tracking-widest mb-1">Total Capacity</div>
                            <div class="text-xl md:text-2xl font-mono font-bold text-amber-500 tracking-tighter">5,432 BTC</div>
                        </div>
                    </div>
                </div>
                <div class="h-[250px] w-full relative">
                    <canvas id="mainChart"></canvas>
                </div>
            </div>

            <div class="flex flex-col gap-6">
                <div class="bg-[#0d0d10] border border-white/5 rounded-[32px] p-6 md:p-8 flex-1 shadow-inner">
                    <div class="w-10 h-10 bg-emerald-500/10 rounded-xl flex items-center justify-center text-emerald-500 mb-6">
                        <i data-lucide="trending-up" class="w-5 h-5"></i>
                    </div>
                    <div class="text-[9px] font-bold text-slate-500 uppercase tracking-widest mb-1">Efficiency</div>
                    <div class="text-2xl md:text-3xl font-bold text-white mb-1 tracking-tighter">0.02%</div>
                    <p class="text-[10px] md:text-[11px] text-slate-500 leading-relaxed font-medium italic">Standard Routing Fees.</p>
                </div>
                <div class="bg-amber-500 rounded-[32px] p-6 md:p-8 flex-1 text-black relative overflow-hidden flex flex-col justify-between shadow-2xl">
                    <i data-lucide="gauge" class="absolute -right-6 -bottom-6 w-32 h-32 opacity-10"></i>
                    <div>
                        <div class="text-[9px] font-black uppercase tracking-widest mb-1 opacity-60 italic">Latency</div>
                        <div class="text-3xl md:text-4xl font-black tracking-tighter leading-none">380ms</div>
                    </div>
                    <p class="text-[9px] md:text-[10px] font-bold opacity-80 mt-6 uppercase tracking-widest italic leading-tight">Instant Verification</p>
                </div>
            </div>
        </div>
    </section>

    <section id="architecture" class="py-12 md:py-24 px-6 max-w-6xl mx-auto z-10 relative">
        <div class="text-center mb-12">
            <h2 class="text-2xl md:text-3xl font-black text-white mb-4 tracking-tighter uppercase italic underline decoration-amber-500/30 underline-offset-8">Layered Architecture</h2>
        </div>

        <div class="flex flex-wrap justify-center gap-2 md:gap-3 mb-12">
            <button onclick="switchTab('lightning')" id="btn-lightning" class="tab-btn px-4 md:px-6 py-2 rounded-xl text-[9px] md:text-[10px] font-bold uppercase tracking-widest border border-amber-500 bg-amber-500 text-black">Lightning Network</button>
            <button onclick="switchTab('sidechains')" id="btn-sidechains" class="tab-btn px-4 md:px-6 py-2 rounded-xl text-[9px] md:text-[10px] font-bold uppercase tracking-widest border border-white/10 bg-white/5 text-slate-500 hover:border-white/20">Sidechains</button>
            <button onclick="switchTab('statechains')" id="btn-statechains" class="tab-btn px-4 md:px-6 py-2 rounded-xl text-[9px] md:text-[10px] font-bold uppercase tracking-widest border border-white/10 bg-white/5 text-slate-500 hover:border-white/20">Statechains</button>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 items-stretch">
            <div class="lg:col-span-8 bg-[#0d0d10] border border-white/5 rounded-[40px] p-8 md:p-12 shadow-2xl min-h-[400px]">
                
                <div id="content-lightning" class="tab-content block animate-fade-in">
                    <div class="flex items-center gap-4 mb-8">
                        <div class="w-12 h-12 bg-amber-500/10 rounded-2xl flex items-center justify-center text-amber-500 border border-amber-500/20">
                            <i data-lucide="database" class="w-6 h-6"></i>
                        </div>
                        <h3 class="text-3xl font-bold text-white tracking-tight italic uppercase">Lightning Network</h3>
                    </div>
                    <p class="text-slate-400 mb-10 leading-relaxed font-medium">Instant, high-velocity state channels enabling near-instant, trustless micropayments for the global economy.</p>
                    <ul class="space-y-4 mb-8">
                        <li class="flex items-center gap-3 text-slate-300 text-sm font-bold italic"><i data-lucide="check-circle-2" class="w-4 h-4 text-amber-500"></i> Bi-directional Channels</li>
                        <li class="flex items-center gap-3 text-slate-300 text-sm font-bold italic"><i data-lucide="check-circle-2" class="w-4 h-4 text-amber-500"></i> Onion Routing</li>
                    </ul>
                </div>

                <div id="content-sidechains" class="tab-content hidden animate-fade-in">
                    <div class="flex items-center gap-4 mb-8">
                        <div class="w-12 h-12 bg-amber-500/10 rounded-2xl flex items-center justify-center text-amber-500 border border-amber-500/20">
                            <i data-lucide="layers" class="w-6 h-6"></i>
                        </div>
                        <h3 class="text-3xl font-bold text-white tracking-tight italic uppercase">Sidechains & Liquid</h3>
                    </div>
                    <p class="text-slate-400 mb-10 leading-relaxed font-medium">Independent blockchains attached via a two-way peg, enabling confidential transactions and complex assets.</p>
                     <ul class="space-y-4 mb-8">
                        <li class="flex items-center gap-3 text-slate-300 text-sm font-bold italic"><i data-lucide="check-circle-2" class="w-4 h-4 text-amber-500"></i> Federated Consensus</li>
                        <li class="flex items-center gap-3 text-slate-300 text-sm font-bold italic"><i data-lucide="check-circle-2" class="w-4 h-4 text-amber-500"></i> Issued Assets</li>
                    </ul>
                </div>

                <div id="content-statechains" class="tab-content hidden animate-fade-in">
                    <div class="flex items-center gap-4 mb-8">
                        <div class="w-12 h-12 bg-amber-500/10 rounded-2xl flex items-center justify-center text-amber-500 border border-amber-500/20">
                            <i data-lucide="link" class="w-6 h-6"></i>
                        </div>
                        <h3 class="text-3xl font-bold text-white tracking-tight italic uppercase">Statechains</h3>
                    </div>
                    <p class="text-slate-400 mb-10 leading-relaxed font-medium">UTXO-based off-chain transfers that enable scaling without the complexity of channel liquidity management.</p>
                     <ul class="space-y-4 mb-8">
                        <li class="flex items-center gap-3 text-slate-300 text-sm font-bold italic"><i data-lucide="check-circle-2" class="w-4 h-4 text-amber-500"></i> UTXO Transfer</li>
                        <li class="flex items-center gap-3 text-slate-300 text-sm font-bold italic"><i data-lucide="check-circle-2" class="w-4 h-4 text-amber-500"></i> Zero-Knowledge Proofs</li>
                    </ul>
                </div>

            </div>
             
             <div class="lg:col-span-4 flex flex-col gap-6">
                <div class="bg-gradient-to-br from-indigo-950/40 to-blue-950/40 border border-white/10 rounded-[40px] p-8 md:p-10 text-white relative overflow-hidden group flex-1">
                   <i data-lucide="cpu" class="absolute -right-8 -bottom-8 w-40 h-40 opacity-10 group-hover:rotate-12 transition-all duration-700"></i>
                   <h4 class="text-[9px] font-black uppercase tracking-widest mb-4 text-blue-400 opacity-70">Security</h4>
                   <div class="text-2xl font-black mb-4 tracking-tighter leading-none uppercase">FRAUD <br />PROOFS</div>
                </div>
                <div class="bg-[#0d0d10] border border-white/5 rounded-[40px] p-8 md:p-10 shadow-xl flex-1">
                   <div class="flex justify-between items-center mb-6">
                      <div class="w-10 h-10 bg-amber-500/10 rounded-xl flex items-center justify-center text-amber-500 border border-amber-500/20 shadow-inner">
                        <i data-lucide="network" class="w-5 h-5"></i>
                      </div>
                      <span class="text-[9px] font-bold text-amber-500 uppercase tracking-widest">Routing</span>
                   </div>
                   <div class="text-xl font-bold text-white mb-4 italic uppercase tracking-tighter">Gossip Protocol</div>
                </div>
             </div>
        </div>
    </section>

    <section id="simulator" class="py-12 md:py-24 px-6 max-w-4xl mx-auto z-10 relative">
        <div class="bg-[#0d0d10] border border-white/5 rounded-[48px] p-8 md:p-16 relative overflow-hidden shadow-2xl">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-amber-500 to-transparent opacity-20"></div>
            <div class="text-center mb-12">
                <div class="w-16 h-16 bg-amber-500/10 rounded-2xl flex items-center justify-center mx-auto mb-6 text-amber-500 border border-amber-500/20">
                    <i data-lucide="calculator" class="w-8 h-8"></i>
                </div>
                <h2 class="text-3xl md:text-4xl font-black text-white mb-4 tracking-tighter uppercase italic">Simulator 3.0</h2>
            </div>

            <div class="mb-12 px-4">
                <div class="flex justify-between items-end mb-6 text-[10px] font-bold uppercase tracking-widest text-slate-500">
                    <span>Value: $<span id="calc-val-display">1000</span></span>
                    <span class="text-amber-500 italic uppercase">Network Load: Standard</span>
                </div>
                <input type="range" min="10" max="10000" step="50" value="1000" id="calc-range" 
                    class="w-full h-1.5 bg-slate-900 rounded-full appearance-none cursor-pointer accent-amber-500 transition-all border border-white/5">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="p-10 rounded-[40px] bg-black/40 border border-white/5">
                    <div class="text-[9px] font-bold text-slate-700 uppercase tracking-widest mb-6 italic opacity-70">L1 Base Layer</div>
                    <div class="text-4xl font-black text-white mb-4 tracking-tighter italic" id="l1-fee">$24.50</div>
                    <p class="text-[10px] text-slate-600 font-bold uppercase tracking-wider italic">Economically Infeasible</p>
                </div>
                <div class="p-10 rounded-[40px] bg-amber-500/5 border border-amber-500/20 shadow-xl">
                    <div class="text-[9px] font-bold text-amber-500 uppercase tracking-widest mb-6 italic opacity-70">Hash Rythm L2</div>
                    <div class="text-4xl font-black text-white mb-4 tracking-tighter italic font-mono">$0.0002</div>
                    <p class="text-[9px] text-emerald-500 font-black uppercase tracking-[0.2em] flex items-center gap-2 mt-6">
                        <i data-lucide="check-circle-2" class="w-4 h-4"></i> 99.9% Fee Optimization
                    </p>
                </div>
            </div>
        </div>
    </section>

    <section id="community" class="py-12 md:py-24 px-6 max-w-3xl mx-auto z-10 relative">
        <div class="text-center mb-16">
            <h2 class="text-3xl font-black text-white mb-4 italic uppercase tracking-tighter">Node Discourse</h2>
            <p class="text-slate-500 text-xs font-bold italic opacity-70 uppercase tracking-widest">Global P2P Collective Feed</p>
        </div>

        <form id="comment-form" class="mb-16 relative group">
            <textarea id="comment-input" required placeholder="Initiate Sync to transmit data..." disabled
                class="w-full bg-[#0d0d10] border border-white/10 rounded-[32px] p-8 text-white text-base focus:ring-4 focus:ring-amber-500/5 focus:border-amber-500/30 outline-none resize-none h-48 transition-all font-medium italic shadow-2xl disabled:opacity-50 disabled:cursor-not-allowed"></textarea>
            <button type="submit" id="submit-btn" disabled
                class="absolute bottom-6 right-6 bg-amber-500 text-black p-4 rounded-2xl hover:bg-amber-400 transition-all shadow-xl shadow-amber-500/20 disabled:opacity-50 disabled:cursor-not-allowed">
                <i data-lucide="send" class="w-5 h-5"></i>
            </button>
        </form>

        <div id="comments-list" class="space-y-6">
            <div class="text-center py-20 opacity-20">
                <i data-lucide="activity" class="w-12 h-12 text-white mx-auto mb-4 animate-pulse"></i>
                <p class="text-white text-[10px] font-black uppercase tracking-widest italic">Broadcasting Handshake...</p>
            </div>
        </div>
    </section>

    <footer class="py-24 px-10 bg-[#040405] border-t border-white/5 z-10 relative">
        <div class="max-w-7xl mx-auto flex justify-between items-center text-slate-700 text-[10px] font-black uppercase tracking-widest italic">
            <span>© 2026 Hash Rythm Research Collective.</span>
            <span>Secure. Scalable. Decentralized.</span>
        </div>
    </footer>

    <div id="auth-modal" class="fixed inset-0 z-[200] flex items-center justify-center p-6 hidden">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-xl" onclick="toggleModal(false)"></div>
                <div class="relative w-full max-w-md bg-[#0d0d10] border border-white/10 p-12 rounded-[40px] shadow-2xl overflow-hidden animate-scale-in">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-amber-500 via-white/5 to-amber-500"></div>
            <button onclick="toggleModal(false)" class="absolute top-8 right-8 text-slate-600 hover:text-white"><i data-lucide="x"></i></button>
            
            <div class="text-center mb-10">
                <div class="w-16 h-16 bg-amber-500/10 rounded-[25px] flex items-center justify-center mx-auto mb-8 text-amber-500 border border-amber-500/20">
                    <i data-lucide="lock" class="w-8 h-8"></i>
                </div>
                <h2 class="text-3xl font-black text-white mb-3 tracking-tighter uppercase italic">Authorize Node</h2>
            </div>

            <div class="space-y-6">
                <input type="text" placeholder="Identity UID (Any)" class="w-full bg-black/50 border border-white/10 rounded-2xl py-5 px-6 text-white text-sm font-bold outline-none focus:border-amber-500/40">
                <input type="password" placeholder="Access Secret (Any)" class="w-full bg-black/50 border border-white/10 rounded-2xl py-5 px-6 text-white text-sm font-bold outline-none focus:border-amber-500/40">
                <button onclick="handleLogin()" class="w-full bg-amber-500 text-black py-5 rounded-2xl font-black uppercase tracking-widest text-xs hover:bg-amber-400 transition-all shadow-xl shadow-amber-500/10">
                    Execute Sync
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        // 1. Initialize Icons
        lucide.createIcons();

        // 2. Firebase Logic (ES Modules)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // YOUR UPDATED FIREBASE CONFIG
        const firebaseConfig = {
          apiKey: "AIzaSyCoCo1HJzNlCHrDvfUEvl23hJIJxH4-nK0",
          authDomain: "hash-rythm-3v.firebaseapp.com",
          projectId: "hash-rythm-3v",
          storageBucket: "hash-rythm-3v.firebasestorage.app",
          messagingSenderId: "364288583174",
          appId: "1:364288583174:web:5fa258658ec04c6df8c587",
          measurementId: "G-1XWPD3RSG6"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = 'hash-rythm-v1';
        let currentUser = null;

        // Auth State Listener
        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            const btn = document.getElementById('auth-btn');
            const input = document.getElementById('comment-input');
            const submitBtn = document.getElementById('submit-btn');

            if (user) {
                // Update UI when logged in
                btn.textContent = "Node Authorized";
                btn.classList.add("bg-amber-500", "text-black");
                btn.classList.remove("bg-white", "text-black");
                
                input.disabled = false;
                input.placeholder = "Input technical feedback...";
                submitBtn.disabled = false;
                
                // Start listening for comments
                subscribeToComments();
            } else {
                // Reset UI when logged out
                btn.textContent = "Initiate Sync";
                btn.classList.add("bg-white", "text-black");
            }
        });

        // Login Handler - FIXED: Added Error Alert
        window.handleLogin = async () => {
            try {
                await signInAnonymously(auth);
                toggleModal(false);
            } catch (error) {
                console.error("Login Failed:", error);
                if (error.code === 'auth/operation-not-allowed') {
                    alert("⚠️ LOGIN FAILED: You must enable 'Anonymous' sign-in in your Firebase Console.");
                } else if (error.code === 'auth/api-key-not-valid') {
                    alert("⚠️ LOGIN FAILED: Your API Key is invalid. Check your Firebase Config.");
                } else {
                    alert("Login Error: " + error.message);
                }
            }
        };

        // Comments System
        function subscribeToComments() {
            const commentsRef = collection(db, 'artifacts', appId, 'public', 'data', 'comments');
            onSnapshot(commentsRef, (snapshot) => {
                const list = document.getElementById('comments-list');
                const docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                // Sort by time descending
                docs.sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));

                if (docs.length === 0) {
                    list.innerHTML = `<div class="text-center py-20 opacity-20">
                        <i data-lucide="activity" class="w-12 h-12 text-white mx-auto mb-4 animate-pulse"></i>
                        <p class="text-white text-[10px] font-black uppercase tracking-widest italic">No data received yet...</p>
                    </div>`;
                    lucide.createIcons();
                    return;
                }

                list.innerHTML = docs.map(c => `
                    <div class="p-8 rounded-[32px] bg-white/[0.01] border border-white/5 hover:bg-white/[0.03] transition-all group shadow-xl mb-4">
                        <div class="flex justify-between items-center mb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-xl bg-amber-500/10 text-amber-500 flex items-center justify-center text-[10px] font-black border border-amber-500/20">
                                    ${c.user ? c.user.charAt(5) : 'N'}
                                </div>
                                <span class="text-amber-500 text-[10px] font-black uppercase tracking-widest italic">${c.user || 'Node'}</span>
                            </div>
                        </div>
                        <p class="text-slate-300 font-bold italic">"${c.text}"</p>
                    </div>
                `).join('');
                lucide.createIcons(); // Refresh icons for new elements
            }, (error) => {
                console.log("Database permission error (normal if rules block access)", error);
            });
        }

        // Form Submit
        document.getElementById('comment-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const input = document.getElementById('comment-input');
            const text = input.value.trim();
            if (!text || !currentUser) return;

            try {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'comments'), {
                    userId: currentUser.uid,
                    user: `Node_${currentUser.uid.slice(0, 4)}`,
                    text: text,
                    timestamp: serverTimestamp()
                });
                input.value = "";
            } catch (err) {
                console.error("Error adding comment:", err);
                alert("Failed to send: Check your Firestore Security Rules.");
            }
        });

        // 3. UI Interactions (Tabs, Modal, Scroll, Simulator)
        
        // Modal Toggle
        window.toggleModal = (show) => {
            const modal = document.getElementById('auth-modal');
            const btn = document.getElementById('auth-btn');
            if (show) {
                modal.classList.remove('hidden');
            } else {
                modal.classList.add('hidden');
            }
        };
        // Bind Navbar Button
        document.getElementById('auth-btn').onclick = () => {
            if (!currentUser) toggleModal(true);
        };

        // Scroll Effect
        window.addEventListener('scroll', () => {
            const nav = document.getElementById('nav-container');
            const navbar = document.getElementById('navbar');
            if (window.scrollY > 20) {
                navbar.classList.add('py-4');
                navbar.classList.remove('py-8');
                nav.classList.add('bg-black/60', 'backdrop-blur-xl', 'border-white/10', 'shadow-xl');
                nav.classList.remove('border-transparent');
            } else {
                navbar.classList.add('py-8');
                navbar.classList.remove('py-4');
                nav.classList.remove('bg-black/60', 'backdrop-blur-xl', 'border-white/10', 'shadow-xl');
                nav.classList.add('border-transparent');
            }
        });

        // Tab Switching
        window.switchTab = (tabName) => {
            // Reset buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.className = "tab-btn px-4 md:px-6 py-2 rounded-xl text-[9px] md:text-[10px] font-bold uppercase tracking-widest border border-white/10 bg-white/5 text-slate-500 hover:border-white/20";
            });
            // Active Button
            const activeBtn = document.getElementById(`btn-${tabName}`);
            activeBtn.className = "tab-btn px-4 md:px-6 py-2 rounded-xl text-[9px] md:text-[10px] font-bold uppercase tracking-widest border border-amber-500 bg-amber-500 text-black";

            // Hide all content
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            // Show active content
            document.getElementById(`content-${tabName}`).classList.remove('hidden');
        };

        // Simulator Logic
        const range = document.getElementById('calc-range');
        const valDisplay = document.getElementById('calc-val-display');
        const l1FeeDisplay = document.getElementById('l1-fee');

        if(range) {
            range.addEventListener('input', (e) => {
                const val = Number(e.target.value);
                valDisplay.innerText = val;
                l1FeeDisplay.innerText = "$" + (val * 0.02 + 4.5).toFixed(2);
            });
        }

        // 4. Chart.js Initialization
        const ctx = document.getElementById('mainChart').getContext('2d');
        const gradient = ctx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, 'rgba(245, 158, 11, 0.2)');
        gradient.addColorStop(1, 'rgba(245, 158, 11, 0)');

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: 'Capacity',
                    data: [4200, 4600, 4400, 5100, 5350, 5432],
                    borderColor: '#f59e0b',
                    backgroundColor: gradient,
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    pointRadius: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { 
                        grid: { display: false },
                        ticks: { color: '#334155', font: { size: 10 } }
                    },
                    y: { display: false }
                }
            }
        });
    </script>
    
    <style>
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeInUp 0.5s ease-out forwards; }
        .animate-fade-in-up { animation: fadeInUp 0.8s forwards; }
    </style>
</body>
</html>
